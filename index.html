<!DOCTYPE html>
<html>
<head>
  <title>FocusGuard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<h1>FocusGuard</h1>

<div class="card">
  <p id="status">Status: Not Started</p>
  <button onclick="startSession()">Start Study</button>
  <button onclick="endSession()">End Study</button>
</div>

<div class="card">
  <h2>Session Report</h2>
  <p id="report"></p>
</div>

<div class="card">
  <h2>History</h2>
  <button onclick="loadHistory()">Load History</button>
  <ul id="history"></ul>
</div>

<script>

let startTime;
let distractionTime = 0;
let hiddenStart;

function startSession() {
    startTime = Date.now();
    distractionTime = 0;
    document.getElementById("status").innerText = "Status: Studying...";
}

function endSession() {
    let totalTime = (Date.now() - startTime) / 1000;
    let focusTime = totalTime - distractionTime;
    let focusPercent = ((focusTime / totalTime) * 100).toFixed(2);

    document.getElementById("report").innerText =
        "Focus Score: " + focusPercent + "%";

    fetch("/save", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            total: totalTime,
            distraction: distractionTime,
            focus: focusTime,
            score: focusPercent
        })
    });
}

document.addEventListener("visibilitychange", function () {
    if (document.hidden) {
        hiddenStart = Date.now();
    } else {
        if (hiddenStart) {
            distractionTime += (Date.now() - hiddenStart) / 1000;
        }
    }
});

function loadHistory() {
    fetch("/history")
    .then(res => res.json())
    .then(data => {
        let list = document.getElementById("history");
        list.innerHTML = "";
        data.forEach(session => {
            let li = document.createElement("li");
            li.innerText = "Score: " + session.score + "%";
            list.appendChild(li);
        });
    });
}

</script>

</body>
</html>
